# 6.3 로그인 처리 - 쿠키 세션

HTTP 프로토콜은 기본적으로 무상태를 유지한다.
하지만 로그인은 사용자 정보를 유지해야 하므로 이것을 쿠키를 통해 구현한다.

- **쿠키 생성**

![img_3.png](img_3.png)

- **쿠키 사용**

![img_2.png](img_2.png)

## 6.3.1 예제

응답 객체 헤더에 쿠키를 담기 위해 핸들러 메서드 파라미터로 `HttpServletResponse`가 필요하다.
로그인 성공 처리 이후 해당 객체 아이디 값을 `addCookie()`로 담아서 전달한다.

- **LoginController**
  - response 헤더에 쿠키 객체를 저장한다.
  - POST 메서드가 실행될 때 `memberId`의 쿠키 값을 클라이언트로 전송한다.
```java
@PostMapping("/login")
public String login(@ModelAttribute("loginForm") LoginForm form, BindingResult bindingResult,
    HttpServletResponse response) {
    if (bindingResult.hasErrors()) {
        return "login/loginForm";
    }

    Member loginMember = loginService.login(form.getLoginId(), form.getPassword());

    if (loginMember == null) {
        bindingResult.reject("loginFail", "아이디 또는 비밀번호가 맞지 않습니다.");
        return "login/loginForm";
    }

    // 로그인 성공 처리, 세션 쿠키
    Cookie idCookie = new Cookie("memberId", String.valueOf(loginMember.getId()));
    response.addCookie(idCookie);
    return "redirect:/";
}
```

- **HomeController**
  - 로그인 성공 후 클라이언트는 본인이 가지고 있는 쿠키값을 서버에게 전송한다.
  - `findById()`에서 쿠키에 있는 `memberId`의 멤버 객체가 있다면 그 객체를 반환한다.
  - 멤버 객체를 모델에 담아서 타임리프 템플릿 뷰로 넘긴다.
```java
@Controller
@RequiredArgsConstructor
public class HomeController {

	private final MemberRepository memberRepository;

    @GetMapping("/")
    public String homeLogin(@CookieValue(name = "memberId", required = false) Long memberId, Model model){
		if (memberId == null) {
			return "home";
		}

		//로그인
		Member loginMember = memberRepository.findById(memberId);
		if(loginMember == null){
			return "home";
		}

		model.addAttribute("member", loginMember);
		return "loginHome";
	}
}
```

## 6.3.2 쿠키와 보안 문제

