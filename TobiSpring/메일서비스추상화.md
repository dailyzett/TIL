# 4. 메일 서비스 추상화

## 4.1 JavaMail을 이용한 메일 발송 기능

<details>
<summary>[UserService.java]JavaMail을 이용한 메일 발송 메서드</summary>
<div markdown="1">

```java
private void sendUpgradeEmail(User user) {
    Properties props = new Properties();
    props.put("mail.smtp.host", "mail.ksug.org");
    Session s = Session.getInstance(props, null);

    MimeMessage message = new MimeMessage(s);
    try {
        message.setFrom(new InternetAddress("semineun@naver.com"));
        message.addRecipient(Message.RecipientType.TO, new InternetAddress(user.getEmail()));
        message.setSubject("Upgrade 안내");
        message.setText("사용자님의 등급이 " + user.getLevel().name() + "로 업그레이드되었습니다.");
    } catch (AddressException e){
        throw new RuntimeException(e);
    } catch (MessagingException e){
        throw new RuntimeException(e);
    }
}
```

</div>
</details>

## 4.2 JavaMail이 포함된 코드의 테스트

여기서 문제는 메일 서버가 준비되지 않은 상태에서 테스트를 하면 SMTP 서버에 연결할 수 없다는 에러가 발생한다.
물론 메일 서버를 제대로 준비해두면 메일이 가지만 테스트할 때마다 매번 메일을 보낼 것인지 의문이 있다.
메일 발송 자체가 부하가 큰 작업이기 때문이다.

메일 발송 기능은 사용자 레벨 업그레이드 작업의 보조적인 기능에 불과하다.
게다가 메일 발송테스트란 사실 불가능하다. 메일이 정말 잘 도착했는지를 확인하지 못한다면
메일 발송 테스트라고 할 수 없기 때문이다.


