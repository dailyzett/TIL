# 1. 서비스 추상화

## 1.1 사용자 레벨 관리 기능 추가

- 계급 관리를 위해 Level enum 생성
- 계급 관리를 위한 User 도메인 프로퍼티 추가
- DB 테이블 컬럼 추가
  - Level / tinyint / NN
  - Login / int / NN
  - Recommend / int / NN
- UserDao 테스트 픽스처 추가
```java
@BeforeEach
public void setUp(){
    this.dao = this.context.getBean("userDao", UserDaoJdbc.class);
    user1 = new User("gyumee", "박성철", "springno1", Level.BASIC, 1, 0);
    user2 = new User("leegw700", "이길원", "springno2", Level.SILVER, 55, 10);
    user3 = new User("bumjin", "박범진", "springno3", Level.GOLD, 100, 40);
}
```
- UserDaoJdbc 수정

## 1.2 사용자 수정 기능 추가

### 수정 기능 테스트 추가
<details>
<summary>1. 사용자 정보 수정 메서드 테스트 코드 작성</summary>
<div markdown="1">

```java
@Test
public void update(){
    dao.deleteAll();

    dao.add(user1);

    user1.setName("오민구");
    user1.setPassword("springno6");
    user1.setLevel(Level.GOLD);
    user1.setLogin(1000);
    user1.setRecommend(999);
    dao.update(user1);

    User user1update = dao.get(user1.getId());
    checkSameUser(user1, user1update);
}
```

</div>
</details>

<details>
<summary>2. UserDao와 UserDaoJdbc 수정</summary>
<div markdown="1">

```java
@Override
public void update(User user) {
    this.jdbcTemplate.update(
            "update users set name=?, password=?, level=?, login=?, " +
                    "recommend = ? where id = ?", user.getName(), user.getPassword(), user.getLevel().intValue(),
            user.getLogin(), user.getRecommend(), user.getId()
    );
}
```
</div>
</details>

### 수정 테스트 보완

현재 update() 테스트는 수정할 로우의 내용이 바뀐 것만을 확인할 뿐이지,
수정하지 않아야 할 로우의 내용이 그대로 남아 있는지는 확인해주지 못한다.

이 테스트 코드를 보완할 방법은 두 가지가 있다.
1. JdbcTemplate의 update()가 돌려주는 리턴값 확인

JdbcTemplate 의 update() 메서드는 영향받은 로우의 개수를 리턴해준다.
따라서 리턴 타입을 int 로 바꾸고 영향받은 로우의 개수와 비교해볼 수 있다.

2. 테스트를 보강해서 원하는 사용자 외의 정보는 변경되지 않았음을 직접 확인

사용자를 두 명 등록해서 그 중 하나만 수정한 뒤에 수정된 사용자와 그렇지 않은 사용자의 정보를 확인한다.


<details>
<summary>3. 보완된 update() 테스트</summary>
<div markdown="1">

```java
@Test
public void update(){
    dao.deleteAll();

    dao.add(user1);
    dao.add(user2);

    user1.setName("오민구");
    user1.setPassword("springno6");
    user1.setLevel(Level.GOLD);
    user1.setLogin(1000);
    user1.setRecommend(999);
    dao.update(user1);

    User user1update = dao.get(user1.getId());
    checkSameUser(user1, user1update);
    User user2same = dao.get(user2.getId());
    checkSameUser(user2, user2same);
}
```
</div>
</details>

보완된  update() 테스트에서 만약 SQL의 WHERE를 빼먹었다면 이 테스트는 실패로 끝날 것이다.

### 1.2.1 UserService.upgradeLevels()

