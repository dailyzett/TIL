## HTTP 쿠키

> 쿠키는 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각이다. 브라우저는 그 데이터 조각들을
> 저장해 놓았다가, 동일한 서버에 재요청 시 저장된 데이터를 함께 전송한다.

쿠키는 두 개의 요청이 동일한 브라우저에서 들어왔는지 아닌지를 판단할 때 주로 사용한다.
상태가 없는 (stateless) HTTP 에 상태 정보를 기억시켜주기 때문에, 쿠키를 이용해서 사용자의 로그인
상태를 기억할 수 있다.

쿠키는 주로 세 가지 목적을 위해 사용된다.

- 세션 관리 : 서버에 저장해야할 로그인, 장바구니 등의 정보 관리
- 개인화 : 개인 사용자의 세팅
- 트래킹 : 사용자 행동을 분석하고 기록하는 용도

과거엔 클라이언트 측에 정보를 저장할 때 쿠키를 주로 이용했다. 저장 방법이 쿠키가 유일한 방법이였을 때는
어쩔 수 없었지만 지금은 modern storage APIs 를 이용해 정보를 저장하는 것을 권장한다. 쿠키를 사용하면
모든 요청마다 쿠키와 함께 서버에 전송되기 때문에 성능이 떨어지는 원인이 될 수 있기 때문이다.


### 1. 쿠키 생성

HTTP 요청을 수신할 때, 서버는 응답과 함께 Set-Cookie 헤더를 전송할 수 있다. 쿠키는 브라우저에 의해
저장되며, 그 후 쿠키는 같은 서버들에 의해 만들어진 요청들의 **Cookie HTTP 헤더**안에 포함되어 전송된다.

#### Set-Cookie

HTTP 응답 헤더는 서버로부터 클라이언트로 전송된다. 간단한 쿠키는 다음과 같이 설정될 수 있다.

```http request
Set-Cookie:<cookie-name>=<cookie-value>
```

서버의 헤더는 클라이언트에게 쿠키를 전달하라고 지시한다.

```http request
HTTP/1.0 200 OK
Content-type: text/html
Set-Cookie: yummy_cookie=choco
Set-Cookie: tasty_cookie=strawberry

[page content]
```

### 1.1 쿠키의 라이프타임

쿠키의 라이프타임은 두 가지로 나뉜다.

- **세션 쿠키(session cookie)** : 현재 세션이 끝날 때 삭제된다. 브라우저는 "현재 세션"이 끝나는 시점을
정의하며, 어떤 브라우저는 재시작할 때 세션을 복원해 세션 쿠키가 무기한 존재할 수 있도록 할 수 있다.
- **영속적 쿠키(permanent cookie)** : Expires 속성에 명시된 날짜가 지나서 삭제되거나, Max-Age
속성에 명시된 기간 이후에 삭제된다.

다음은 예시이다.
```http request
Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;
```

※ 주의해야할 점은 만료날짜가 설정되면 설정된 시간과 날짜는 서버가 아니라 쿠키가 설정되는
클라이언트를 기준으로 한다.


### 1.2 Secure 쿠키, HttpOnly 쿠키

Secure 쿠키는 https 프로토콜 상에서 암호화된 요청일 경우에만 전송된다. http: 에는 쿠키에 Secure 설정을 할 수 없다.
또한, Secure 일지라도 유출되지 말아야 할 정보는 쿠키에 저장하는 것을 지양해야한다.

cross-site 스크립팅(XSS) 공격을 방지하기 위해, HttpOnly 쿠키는 브라우저에서 쿠키에 접근할 수 없도록 제한한다.
HttpOnly 접미사를 추가하면 웹브라우저에서 해당 쿠키로 접근할 수 없게 되지만, 쿠키에 포함된 대부분의 정보는 브라우저에서
접근할 필요가 없기 때문에 HTTP Only Cookie는 기본적으로 사용하는 것이 좋다.

> XSS는 해커가 안전하다고 생각하는 웹사이트에 악성 스크립트를 주입하고, 해당 게시글을 열람한 사람들의 쿠키가
> 해커에게 전송되게 만든다. 이를 통해 해커는 피해자의 브라우저에서 스크립트를 실행해 세션 가로채기, 웹 사이트 변조,
> 피싱 공격 등을 시도한다.


### 2. 쿠키 스코프

Domain 과 Path 디렉티브는 쿠키의 스코프를 정의한다.

- Domain : 쿠키가 전송할 호스트를 명시한다. 만약 명시되지 않으면, 현재 문서 위치의 일부를 기본값으로 한다.
- Path : Cookie 헤더를 전송하기 위하여 반드시 존재해야 하는 URL 경로이다.
만약 **path=/docs** 가 설정되면, 다음의 경로가 모두 매치된다.
  - /docs
  - /docs/web
  - /docs/web/HTTP

다음은 예시이다.

```http request
Set-Cookie: name=Greg; domain=nczonline.net; path=/blog
```

### 3. 쿠키의 종류

- 퍼스트 파티 쿠키

사용자가 방문한 웹사이트에서 직접 발행하는 쿠키 파일을 말한다. 사용자가 google.com에 접속했을 때
해당 사이트에서 로그인 기록에 관한 쿠키를 발행하는 건 퍼스트 파티 쿠키에 해당한다. 서브 도메인이 발행한
쿠키도 퍼스트 쿠키로 간주한다.

- 서드 파티 쿠키

사용자가 방문한 웹 사이트가 아닌, 다른 웹사이트에서 발행한 쿠키 파일을 말한다. 보통 광고 서버에서 발행하는
쿠키가 여기에 해당된다.



### 4. 참고 자료

[developer.mozilla.org](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies#secure%EA%B3%BC_httponly_%EC%BF%A0%ED%82%A4) <br>
[humanwhocodes.com](https://humanwhocodes.com/blog/2009/05/05/http-cookies-explained/)

